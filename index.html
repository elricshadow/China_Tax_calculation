<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8" />
    <title>中国税费计算器</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body {
            font-family: "Segoe UI", "PingFang SC", Arial, sans-serif;
            background: linear-gradient(120deg, #eaf4ff 0%, #f7f7f7 100%);
            margin: 0;
            min-height: 100vh;
        }
        .container {
            background: #fff;
            padding: 28px 20px;
            border-radius: 14px;
            max-width: 520px;
            margin: 36px auto;
            box-shadow: 0 6px 30px rgba(58, 115, 212, 0.12);
        }
        h2 {
            text-align: center;
            color: #2f5bd8;
            margin-bottom: 18px;
            font-size: 1.6rem;
            letter-spacing: 1px;
        }
        .section-title {
            font-size: 1.05rem;
            color: #1e4aa7;
            margin: 18px 0 10px;
            font-weight: 700;
            border-left: 4px solid #3d5afe;
            padding-left: 10px;
            letter-spacing: 0.4px;
        }
        label {
            display: block;
            margin: 10px 0 6px;
            font-size: 0.98rem;
            color: #2a5ea6;
        }
        input[type="number"], select {
            width: 100%;
            padding: 10px 12px;
            font-size: 1rem;
            border-radius: 8px;
            border: 1.2px solid #cfe1ff;
            background: #fbfeff;
            transition: border-color .18s, box-shadow .18s;
            outline: none;
            box-sizing: border-box;
        }
        input[type="number"]:focus, select:focus {
            border-color: #3d5afe;
            box-shadow: 0 6px 18px rgba(61, 90, 254, 0.06);
        }
        .flex-row { display:flex; gap:10px; align-items:center; }
        .flex-row > * { flex: 1; }
        .amount-short { width: 180px; max-width: 46%; }
        .rate-input { max-width: 160px; }
        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(90deg,#3d5afe 40%, #6fb7ff 100%);
            color: #fff;
            font-size: 1.02rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 14px;
            box-shadow: 0 6px 18px rgba(61, 90, 254, 0.12);
        }
        .btn:active { transform: translateY(1px); }
        .result {
            margin-top: 16px;
            font-size: 1rem;
            background: linear-gradient(180deg,#fbfeff, #f5fbff);
            border-radius: 10px;
            padding: 14px;
            box-shadow: 0 6px 18px rgba(19, 87, 209, 0.06);
        }
        .tax-type {
            font-weight: 700;
            margin: 10px 0 8px;
            color: #2a5ea6;
            display:flex; align-items:center; gap:8px;
        }
        .hint {
            margin: 8px 0;
            color: #ff9800;
            font-weight: 600;
        }
        .err {
            color: #d32f2f;
            font-weight: 700;
            text-align:center;
            padding:8px 0;
        }

        /* 城建税卡片样式 */
        .tax-city-row {
            display:flex;
            gap:10px;
            margin: 8px 0 12px;
        }
        .tax-city-card {
            flex:1;
            padding:10px 8px;
            text-align:center;
            border-radius:8px;
            border:1.2px solid #e6f0ff;
            background:#fbfeff;
            cursor:pointer;
            transition: all .16s;
            user-select:none;
        }
        .tax-city-card.selected {
            border-color:#3d5afe;
            background: linear-gradient(180deg,#eaf2ff,#e1f0ff);
            box-shadow: 0 6px 16px rgba(61,90,254,0.08);
            color:#2a4fc6;
            font-weight:700;
        }
        .tax-city-name { font-size:0.98rem; color:#1f4ea0; }
        .tax-city-rate { margin-top:6px; font-size:0.95rem; color:#2e7d32; font-weight:700; }

        @media (max-width:520px) {
            .container { margin: 20px 12px; padding:18px; }
            .amount-short { width: 130px; }
            .rate-input { max-width: 120px; }
            .tax-city-row { gap:6px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>中国税费计算器</h2>

        <div class="section-title">增值税计算</div>

        <label for="amount">金额（元） — 请输入未含税金额（若为含税金额请选择“含税模式”）</label>
        <div class="flex-row" style="align-items:center;">
            <input type="number" id="amount" class="amount-short" min="0" step="0.01" placeholder="金额（元）" />
            <select id="mode" title="金额模式" style="max-width:160px;">
                <option value="exclusive">未含税（默认）</option>
                <option value="inclusive">含税金额（倒算税额）</option>
            </select>
            <div style="width:10px"></div>
        </div>

        <label for="rate-select">税率：</label>
        <div class="flex-row">
            <select id="rate-select" onchange="updateRateInput()">
                <option value="13">13%</option>
                <option value="11">11%</option>
                <option value="10">10%</option>
                <option value="9">9%</option>
                <option value="6">6%</option>
                <option value="3">3%</option>
                <option value="1">1%</option>
                <option value="0">0%</option>
                <option value="other">自定义</option>
            </select>
            <input type="number" id="rate" class="rate-input" min="0" max="100" step="0.01" placeholder="税率(%)" value="13" oninput="selectOtherRate()" />
        </div>

        <div class="section-title" style="margin-top:12px; font-size:1rem;">城建税/附加税设置</div>
        <div style="font-size:0.95rem; color:#1565c0; margin-bottom:8px;">选择城建税适用区域（教育费附加：3%，地方教育附加：2%；均按已缴纳增值税额计征）</div>
        <div class="tax-city-row" id="tax-city-row">
            <div class="tax-city-card selected" data-rate="0.07" onclick="selectCity(this)">
                <div class="tax-city-name">城市</div>
                <div class="tax-city-rate">城建税 7%</div>
            </div>
            <div class="tax-city-card" data-rate="0.05" onclick="selectCity(this)">
                <div class="tax-city-name">县/镇</div>
                <div class="tax-city-rate">城建税 5%</div>
            </div>
            <div class="tax-city-card" data-rate="0.01" onclick="selectCity(this)">
                <div class="tax-city-name">乡/村</div>
                <div class="tax-city-rate">城建税 1%</div>
            </div>
        </div>

        <button class="btn" onclick="calculateVAT()">💰 计算增值税与附加税</button>

        <div class="result" id="vat-result" aria-live="polite"></div>

        <!-- 保留其他部分占位（可按需隐藏/移动） -->
        <div style="height:6px"></div>
    </div>

    <script>
        // 城建税卡片选择
        function selectCity(card) {
            document.querySelectorAll('.tax-city-card').forEach(function(c){
                c.classList.remove('selected');
            });
            card.classList.add('selected');
        }
        function getSelectedCityRate() {
            var sel = document.querySelector('.tax-city-card.selected');
            return sel ? parseFloat(sel.getAttribute('data-rate')) : 0.07;
        }

        // 税率选择/自定义逻辑
        function updateRateInput() {
            var sel = document.getElementById('rate-select');
            var input = document.getElementById('rate');
            if (sel.value === 'other') {
                input.value = '';
                input.focus();
            } else {
                input.value = sel.value;
            }
        }
        function selectOtherRate() {
            var input = document.getElementById('rate');
            var sel = document.getElementById('rate-select');
            var presets = ['13','11','10','9','6','3','1','0'];
            if (!presets.includes(String(input.value))) sel.value = 'other';
        }

        // 计算逻辑（含：小规模免税提示 + 城建税/教育附加/地方教育附加）
        function calculateVAT() {
            var amountEl = document.getElementById('amount');
            var mode = document.getElementById('mode').value; // exclusive | inclusive
            var rate = parseFloat(document.getElementById('rate').value);
            var vatResultEl = document.getElementById('vat-result');
            var cityRate = getSelectedCityRate();

            // 验证
            var amountRaw = parseFloat(amountEl.value);
            if (isNaN(amountRaw) || amountRaw < 0 || isNaN(rate) || rate < 0 || rate > 100) {
                vatResultEl.innerHTML = '<div class="err">请输入有效的金额和税率（税率 0 - 100）</div>';
                return;
            }

            var r = rate / 100;
            var vatPayable = 0; // 实缴增值税额（价外税情形）
            var taxableBase_excl = 0; // 未含税金额基数
            var totalWithVat = 0;
            var vatInside = 0;
            var amountWithoutTax = 0;

            if (mode === 'exclusive') {
                taxableBase_excl = amountRaw;
                vatPayable = +(taxableBase_excl * r);
                totalWithVat = +(taxableBase_excl + vatPayable);
                // 价内计算（如果需要倒算以 amountRaw 为含税金额时）
                vatInside = +(amountRaw * r / (1 + r));
                amountWithoutTax = +(amountRaw / (1 + r));
            } else {
                // 用户输入的是含税金额，倒算未税与税额
                totalWithVat = amountRaw;
                vatInside = +(amountRaw * r / (1 + r));
                amountWithoutTax = +(amountRaw / (1 + r));
                taxableBase_excl = amountWithoutTax;
                vatPayable = vatInside;
            }

            // 小规模免税判断
            // 说明：按“月销售额 ≤ 100000 元（10 万）”可免征增值税（小规模纳税人免税政策）
            var smallScaleThreshold = 100000; // 10 万
            var smallScaleHint = '';
            var isSmallScaleExempt = false;
            // 判断以未含税月销售额为准（taxableBase_excl）
            if (taxableBase_excl <= smallScaleThreshold) {
                // 如果税率不为0，实际小规模免税需要税务申报认定，这里只给出提示并在计算时可以显示“可免征”
                smallScaleHint = '<div class="hint">提示：该未含税金额 ≤ ¥' + smallScaleThreshold.toLocaleString() + '，可能符合“小规模纳税人免征”条件（请按当地税务规定申报）。</div>';
                // We do not force-set vatPayable to 0 automatically; show option: but per user request they wanted display — we'll display "可免征"提醒并给出两套结果：一是正常计算，一是若申报免税则税费为0。
                isSmallScaleExempt = true;
            }

            // 附加税费按已缴纳增值税额计征（即 vatPayable）
            var cityTax = +(vatPayable * cityRate);
            var eduSurcharge = +(vatPayable * 0.03); // 教育费附加 3%
            var localEduSurcharge = +(vatPayable * 0.02); // 地方教育附加 2%
            var totalSurcharges = +(cityTax + eduSurcharge + localEduSurcharge);

            // 当小规模且用户可能选择申报免征，显示免征情形（供参考）
            var exemptVat = 0, exemptCityTax = 0, exemptEdu = 0, exemptLocalEdu = 0, exemptTotalAdd = 0;
            if (isSmallScaleExempt) {
                exemptVat = 0;
                exemptCityTax = 0;
                exemptEdu = 0;
                exemptLocalEdu = 0;
                exemptTotalAdd = 0;
            }

            // 构建展示
            var html = '';
            if (smallScaleHint) html += smallScaleHint;

            html += '<div class="tax-type">增值税（按 ' + (mode==='exclusive' ? '未含税金额' : '含税金额') + ' 计算）</div>';

            html += '<div>未含税金额（基数）： <b style="color:#1565c0;">' + taxableBase_excl.toFixed(2) + '</b> 元</div>';
            html += '<div>增值税（税率 ' + rate.toFixed(2) + '%）： <b style="color:#43a047;">' + vatPayable.toFixed(2) + '</b> 元</div>';
            html += '<div>含税总额： <b style="color:#3d5afe;">' + totalWithVat.toFixed(2) + '</b> 元</div>';

            html += '<div class="tax-type">价内税（若以含税金额为基数进行倒算）</div>';
            html += '<div>含税金额： <b style="color:#1565c0;">' + totalWithVat.toFixed(2) + '</b> 元</div>';
            html += '<div>倒算增值税： <b style="color:#e65100;">' + vatInside.toFixed(2) + '</b> 元</div>';
            html += '<div>倒算未含税金额： <b style="color:#00838f;">' + amountWithoutTax.toFixed(2) + '</b> 元</div>';

            html += '<div class="tax-type">附加税费（按已缴纳增值税额计征）</div>';
            html += '<div>城建税（适用率 ' + (getSelectedCityRate()*100).toFixed(2) + '%）： <b>' + cityTax.toFixed(2) + '</b> 元</div>';
            html += '<div>教育费附加（3%）： <b>' + eduSurcharge.toFixed(2) + '</b> 元</div>';
            html += '<div>地方教育附加（2%）： <b>' + localEduSurcharge.toFixed(2) + '</b> 元</div>';
            html += '<div>附加税合计： <b style="color:#e65100;">' + totalSurcharges.toFixed(2) + '</b> 元</div>';

            // 如果可能免征，给出“若申报免征”的对比显示，便于用户直观判断差额
            if (isSmallScaleExempt) {
                html += '<div class="tax-type" style="margin-top:10px;">若申报小规模免征（参考）</div>';
                html += '<div>增值税：<b style="color:#43a047;">0.00</b> 元（免征）</div>';
                html += '<div>城建税：<b>0.00</b> 元；教育费附加：<b>0.00</b> 元；地方教育附加：<b>0.00</b> 元</div>';
                html += '<div class="hint" style="margin-top:8px;">注：实际是否免征由税务机关认定，本工具仅作参考计算。</div>';
            }

            vatResultEl.innerHTML = html;
        }

        // 初始化: ensure default selected card on load
        (function(){
            // ensure one selected
            if (!document.querySelector('.tax-city-card.selected')) {
                var first = document.querySelector('.tax-city-card');
                if (first) first.classList.add('selected');
            }
        })();
    </script>
</body>
</html>
