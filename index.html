<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8" />
    <title>ä¸­å›½ç¨è´¹è®¡ç®—å™¨</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body {
            font-family: "Segoe UI", "PingFang SC", Arial, sans-serif;
            background: linear-gradient(120deg, #eaf4ff 0%, #f7f7f7 100%);
            margin: 0;
            min-height: 100vh;
        }
        .container {
            background: #fff;
            padding: 28px 20px;
            border-radius: 14px;
            max-width: 520px;
            margin: 36px auto;
            box-shadow: 0 6px 30px rgba(58, 115, 212, 0.12);
        }
        h2 {
            text-align: center;
            color: #2f5bd8;
            margin-bottom: 18px;
            font-size: 1.6rem;
            letter-spacing: 1px;
        }
        .section-title {
            font-size: 1.05rem;
            color: #1e4aa7;
            margin: 18px 0 10px;
            font-weight: 700;
            border-left: 4px solid #3d5afe;
            padding-left: 10px;
            letter-spacing: 0.4px;
        }
        label {
            display: block;
            margin: 10px 0 6px;
            font-size: 0.98rem;
            color: #2a5ea6;
        }
        input[type="number"], select {
            width: 100%;
            padding: 10px 12px;
            font-size: 1rem;
            border-radius: 8px;
            border: 1.2px solid #cfe1ff;
            background: #fbfeff;
            transition: border-color .18s, box-shadow .18s;
            outline: none;
            box-sizing: border-box;
        }
        input[type="number"]:focus, select:focus {
            border-color: #3d5afe;
            box-shadow: 0 6px 18px rgba(61, 90, 254, 0.06);
        }
        .flex-row { display:flex; gap:10px; align-items:center; }
        .flex-row > * { flex: 1; }
        .amount-short { width: 180px; max-width: 46%; }
        .rate-input { max-width: 160px; }
        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(90deg,#3d5afe 40%, #6fb7ff 100%);
            color: #fff;
            font-size: 1.02rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 14px;
            box-shadow: 0 6px 18px rgba(61, 90, 254, 0.12);
        }
        .btn:active { transform: translateY(1px); }
        .result {
            margin-top: 16px;
            font-size: 1rem;
            background: linear-gradient(180deg,#fbfeff, #f5fbff);
            border-radius: 10px;
            padding: 14px;
            box-shadow: 0 6px 18px rgba(19, 87, 209, 0.06);
        }
        .tax-type {
            font-weight: 700;
            margin: 10px 0 8px;
            color: #2a5ea6;
            display:flex; align-items:center; gap:8px;
        }
        .hint {
            margin: 8px 0;
            color: #ff9800;
            font-weight: 600;
        }
        .err {
            color: #d32f2f;
            font-weight: 700;
            text-align:center;
            padding:8px 0;
        }

        /* åŸå»ºç¨å¡ç‰‡æ ·å¼ */
        .tax-city-row {
            display:flex;
            gap:10px;
            margin: 8px 0 12px;
        }
        .tax-city-card {
            flex:1;
            padding:10px 8px;
            text-align:center;
            border-radius:8px;
            border:1.2px solid #e6f0ff;
            background:#fbfeff;
            cursor:pointer;
            transition: all .16s;
            user-select:none;
        }
        .tax-city-card.selected {
            border-color:#3d5afe;
            background: linear-gradient(180deg,#eaf2ff,#e1f0ff);
            box-shadow: 0 6px 16px rgba(61,90,254,0.08);
            color:#2a4fc6;
            font-weight:700;
        }
        .tax-city-name { font-size:0.98rem; color:#1f4ea0; }
        .tax-city-rate { margin-top:6px; font-size:0.95rem; color:#2e7d32; font-weight:700; }

        @media (max-width:520px) {
            .container { margin: 20px 12px; padding:18px; }
            .amount-short { width: 130px; }
            .rate-input { max-width: 120px; }
            .tax-city-row { gap:6px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>ä¸­å›½ç¨è´¹è®¡ç®—å™¨</h2>

        <div class="section-title">å¢å€¼ç¨è®¡ç®—</div>

        <label for="amount">é‡‘é¢ï¼ˆå…ƒï¼‰ â€” è¯·è¾“å…¥æœªå«ç¨é‡‘é¢ï¼ˆè‹¥ä¸ºå«ç¨é‡‘é¢è¯·é€‰æ‹©â€œå«ç¨æ¨¡å¼â€ï¼‰</label>
        <div class="flex-row" style="align-items:center;">
            <input type="number" id="amount" class="amount-short" min="0" step="0.01" placeholder="é‡‘é¢ï¼ˆå…ƒï¼‰" />
            <select id="mode" title="é‡‘é¢æ¨¡å¼" style="max-width:160px;">
                <option value="exclusive">æœªå«ç¨ï¼ˆé»˜è®¤ï¼‰</option>
                <option value="inclusive">å«ç¨é‡‘é¢ï¼ˆå€’ç®—ç¨é¢ï¼‰</option>
            </select>
            <div style="width:10px"></div>
        </div>

        <label for="rate-select">ç¨ç‡ï¼š</label>
        <div class="flex-row">
            <select id="rate-select" onchange="updateRateInput()">
                <option value="13">13%</option>
                <option value="11">11%</option>
                <option value="10">10%</option>
                <option value="9">9%</option>
                <option value="6">6%</option>
                <option value="3">3%</option>
                <option value="1">1%</option>
                <option value="0">0%</option>
                <option value="other">è‡ªå®šä¹‰</option>
            </select>
            <input type="number" id="rate" class="rate-input" min="0" max="100" step="0.01" placeholder="ç¨ç‡(%)" value="13" oninput="selectOtherRate()" />
        </div>

        <div class="section-title" style="margin-top:12px; font-size:1rem;">åŸå»ºç¨/é™„åŠ ç¨è®¾ç½®</div>
        <div style="font-size:0.95rem; color:#1565c0; margin-bottom:8px;">é€‰æ‹©åŸå»ºç¨é€‚ç”¨åŒºåŸŸï¼ˆæ•™è‚²è´¹é™„åŠ ï¼š3%ï¼Œåœ°æ–¹æ•™è‚²é™„åŠ ï¼š2%ï¼›å‡æŒ‰å·²ç¼´çº³å¢å€¼ç¨é¢è®¡å¾ï¼‰</div>
        <div class="tax-city-row" id="tax-city-row">
            <div class="tax-city-card selected" data-rate="0.07" onclick="selectCity(this)">
                <div class="tax-city-name">åŸå¸‚</div>
                <div class="tax-city-rate">åŸå»ºç¨ 7%</div>
            </div>
            <div class="tax-city-card" data-rate="0.05" onclick="selectCity(this)">
                <div class="tax-city-name">å¿/é•‡</div>
                <div class="tax-city-rate">åŸå»ºç¨ 5%</div>
            </div>
            <div class="tax-city-card" data-rate="0.01" onclick="selectCity(this)">
                <div class="tax-city-name">ä¹¡/æ‘</div>
                <div class="tax-city-rate">åŸå»ºç¨ 1%</div>
            </div>
        </div>

        <button class="btn" onclick="calculateVAT()">ğŸ’° è®¡ç®—å¢å€¼ç¨ä¸é™„åŠ ç¨</button>

        <div class="result" id="vat-result" aria-live="polite"></div>

        <!-- ä¿ç•™å…¶ä»–éƒ¨åˆ†å ä½ï¼ˆå¯æŒ‰éœ€éšè—/ç§»åŠ¨ï¼‰ -->
        <div style="height:6px"></div>
    </div>

    <script>
        // åŸå»ºç¨å¡ç‰‡é€‰æ‹©
        function selectCity(card) {
            document.querySelectorAll('.tax-city-card').forEach(function(c){
                c.classList.remove('selected');
            });
            card.classList.add('selected');
        }
        function getSelectedCityRate() {
            var sel = document.querySelector('.tax-city-card.selected');
            return sel ? parseFloat(sel.getAttribute('data-rate')) : 0.07;
        }

        // ç¨ç‡é€‰æ‹©/è‡ªå®šä¹‰é€»è¾‘
        function updateRateInput() {
            var sel = document.getElementById('rate-select');
            var input = document.getElementById('rate');
            if (sel.value === 'other') {
                input.value = '';
                input.focus();
            } else {
                input.value = sel.value;
            }
        }
        function selectOtherRate() {
            var input = document.getElementById('rate');
            var sel = document.getElementById('rate-select');
            var presets = ['13','11','10','9','6','3','1','0'];
            if (!presets.includes(String(input.value))) sel.value = 'other';
        }

        // è®¡ç®—é€»è¾‘ï¼ˆå«ï¼šå°è§„æ¨¡å…ç¨æç¤º + åŸå»ºç¨/æ•™è‚²é™„åŠ /åœ°æ–¹æ•™è‚²é™„åŠ ï¼‰
        function calculateVAT() {
            var amountEl = document.getElementById('amount');
            var mode = document.getElementById('mode').value; // exclusive | inclusive
            var rate = parseFloat(document.getElementById('rate').value);
            var vatResultEl = document.getElementById('vat-result');
            var cityRate = getSelectedCityRate();

            // éªŒè¯
            var amountRaw = parseFloat(amountEl.value);
            if (isNaN(amountRaw) || amountRaw < 0 || isNaN(rate) || rate < 0 || rate > 100) {
                vatResultEl.innerHTML = '<div class="err">è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢å’Œç¨ç‡ï¼ˆç¨ç‡ 0 - 100ï¼‰</div>';
                return;
            }

            var r = rate / 100;
            var vatPayable = 0; // å®ç¼´å¢å€¼ç¨é¢ï¼ˆä»·å¤–ç¨æƒ…å½¢ï¼‰
            var taxableBase_excl = 0; // æœªå«ç¨é‡‘é¢åŸºæ•°
            var totalWithVat = 0;
            var vatInside = 0;
            var amountWithoutTax = 0;

            if (mode === 'exclusive') {
                taxableBase_excl = amountRaw;
                vatPayable = +(taxableBase_excl * r);
                totalWithVat = +(taxableBase_excl + vatPayable);
                // ä»·å†…è®¡ç®—ï¼ˆå¦‚æœéœ€è¦å€’ç®—ä»¥ amountRaw ä¸ºå«ç¨é‡‘é¢æ—¶ï¼‰
                vatInside = +(amountRaw * r / (1 + r));
                amountWithoutTax = +(amountRaw / (1 + r));
            } else {
                // ç”¨æˆ·è¾“å…¥çš„æ˜¯å«ç¨é‡‘é¢ï¼Œå€’ç®—æœªç¨ä¸ç¨é¢
                totalWithVat = amountRaw;
                vatInside = +(amountRaw * r / (1 + r));
                amountWithoutTax = +(amountRaw / (1 + r));
                taxableBase_excl = amountWithoutTax;
                vatPayable = vatInside;
            }

            // å°è§„æ¨¡å…ç¨åˆ¤æ–­
            // è¯´æ˜ï¼šæŒ‰â€œæœˆé”€å”®é¢ â‰¤ 100000 å…ƒï¼ˆ10 ä¸‡ï¼‰â€å¯å…å¾å¢å€¼ç¨ï¼ˆå°è§„æ¨¡çº³ç¨äººå…ç¨æ”¿ç­–ï¼‰
            var smallScaleThreshold = 100000; // 10 ä¸‡
            var smallScaleHint = '';
            var isSmallScaleExempt = false;
            // åˆ¤æ–­ä»¥æœªå«ç¨æœˆé”€å”®é¢ä¸ºå‡†ï¼ˆtaxableBase_exclï¼‰
            if (taxableBase_excl <= smallScaleThreshold) {
                // å¦‚æœç¨ç‡ä¸ä¸º0ï¼Œå®é™…å°è§„æ¨¡å…ç¨éœ€è¦ç¨åŠ¡ç”³æŠ¥è®¤å®šï¼Œè¿™é‡Œåªç»™å‡ºæç¤ºå¹¶åœ¨è®¡ç®—æ—¶å¯ä»¥æ˜¾ç¤ºâ€œå¯å…å¾â€
                smallScaleHint = '<div class="hint">æç¤ºï¼šè¯¥æœªå«ç¨é‡‘é¢ â‰¤ Â¥' + smallScaleThreshold.toLocaleString() + 'ï¼Œå¯èƒ½ç¬¦åˆâ€œå°è§„æ¨¡çº³ç¨äººå…å¾â€æ¡ä»¶ï¼ˆè¯·æŒ‰å½“åœ°ç¨åŠ¡è§„å®šç”³æŠ¥ï¼‰ã€‚</div>';
                // We do not force-set vatPayable to 0 automatically; show option: but per user request they wanted display â€” we'll display "å¯å…å¾"æé†’å¹¶ç»™å‡ºä¸¤å¥—ç»“æœï¼šä¸€æ˜¯æ­£å¸¸è®¡ç®—ï¼Œä¸€æ˜¯è‹¥ç”³æŠ¥å…ç¨åˆ™ç¨è´¹ä¸º0ã€‚
                isSmallScaleExempt = true;
            }

            // é™„åŠ ç¨è´¹æŒ‰å·²ç¼´çº³å¢å€¼ç¨é¢è®¡å¾ï¼ˆå³ vatPayableï¼‰
            var cityTax = +(vatPayable * cityRate);
            var eduSurcharge = +(vatPayable * 0.03); // æ•™è‚²è´¹é™„åŠ  3%
            var localEduSurcharge = +(vatPayable * 0.02); // åœ°æ–¹æ•™è‚²é™„åŠ  2%
            var totalSurcharges = +(cityTax + eduSurcharge + localEduSurcharge);

            // å½“å°è§„æ¨¡ä¸”ç”¨æˆ·å¯èƒ½é€‰æ‹©ç”³æŠ¥å…å¾ï¼Œæ˜¾ç¤ºå…å¾æƒ…å½¢ï¼ˆä¾›å‚è€ƒï¼‰
            var exemptVat = 0, exemptCityTax = 0, exemptEdu = 0, exemptLocalEdu = 0, exemptTotalAdd = 0;
            if (isSmallScaleExempt) {
                exemptVat = 0;
                exemptCityTax = 0;
                exemptEdu = 0;
                exemptLocalEdu = 0;
                exemptTotalAdd = 0;
            }

            // æ„å»ºå±•ç¤º
            var html = '';
            if (smallScaleHint) html += smallScaleHint;

            html += '<div class="tax-type">å¢å€¼ç¨ï¼ˆæŒ‰ ' + (mode==='exclusive' ? 'æœªå«ç¨é‡‘é¢' : 'å«ç¨é‡‘é¢') + ' è®¡ç®—ï¼‰</div>';

            html += '<div>æœªå«ç¨é‡‘é¢ï¼ˆåŸºæ•°ï¼‰ï¼š <b style="color:#1565c0;">' + taxableBase_excl.toFixed(2) + '</b> å…ƒ</div>';
            html += '<div>å¢å€¼ç¨ï¼ˆç¨ç‡ ' + rate.toFixed(2) + '%ï¼‰ï¼š <b style="color:#43a047;">' + vatPayable.toFixed(2) + '</b> å…ƒ</div>';
            html += '<div>å«ç¨æ€»é¢ï¼š <b style="color:#3d5afe;">' + totalWithVat.toFixed(2) + '</b> å…ƒ</div>';

            html += '<div class="tax-type">ä»·å†…ç¨ï¼ˆè‹¥ä»¥å«ç¨é‡‘é¢ä¸ºåŸºæ•°è¿›è¡Œå€’ç®—ï¼‰</div>';
            html += '<div>å«ç¨é‡‘é¢ï¼š <b style="color:#1565c0;">' + totalWithVat.toFixed(2) + '</b> å…ƒ</div>';
            html += '<div>å€’ç®—å¢å€¼ç¨ï¼š <b style="color:#e65100;">' + vatInside.toFixed(2) + '</b> å…ƒ</div>';
            html += '<div>å€’ç®—æœªå«ç¨é‡‘é¢ï¼š <b style="color:#00838f;">' + amountWithoutTax.toFixed(2) + '</b> å…ƒ</div>';

            html += '<div class="tax-type">é™„åŠ ç¨è´¹ï¼ˆæŒ‰å·²ç¼´çº³å¢å€¼ç¨é¢è®¡å¾ï¼‰</div>';
            html += '<div>åŸå»ºç¨ï¼ˆé€‚ç”¨ç‡ ' + (getSelectedCityRate()*100).toFixed(2) + '%ï¼‰ï¼š <b>' + cityTax.toFixed(2) + '</b> å…ƒ</div>';
            html += '<div>æ•™è‚²è´¹é™„åŠ ï¼ˆ3%ï¼‰ï¼š <b>' + eduSurcharge.toFixed(2) + '</b> å…ƒ</div>';
            html += '<div>åœ°æ–¹æ•™è‚²é™„åŠ ï¼ˆ2%ï¼‰ï¼š <b>' + localEduSurcharge.toFixed(2) + '</b> å…ƒ</div>';
            html += '<div>é™„åŠ ç¨åˆè®¡ï¼š <b style="color:#e65100;">' + totalSurcharges.toFixed(2) + '</b> å…ƒ</div>';

            // å¦‚æœå¯èƒ½å…å¾ï¼Œç»™å‡ºâ€œè‹¥ç”³æŠ¥å…å¾â€çš„å¯¹æ¯”æ˜¾ç¤ºï¼Œä¾¿äºç”¨æˆ·ç›´è§‚åˆ¤æ–­å·®é¢
            if (isSmallScaleExempt) {
                html += '<div class="tax-type" style="margin-top:10px;">è‹¥ç”³æŠ¥å°è§„æ¨¡å…å¾ï¼ˆå‚è€ƒï¼‰</div>';
                html += '<div>å¢å€¼ç¨ï¼š<b style="color:#43a047;">0.00</b> å…ƒï¼ˆå…å¾ï¼‰</div>';
                html += '<div>åŸå»ºç¨ï¼š<b>0.00</b> å…ƒï¼›æ•™è‚²è´¹é™„åŠ ï¼š<b>0.00</b> å…ƒï¼›åœ°æ–¹æ•™è‚²é™„åŠ ï¼š<b>0.00</b> å…ƒ</div>';
                html += '<div class="hint" style="margin-top:8px;">æ³¨ï¼šå®é™…æ˜¯å¦å…å¾ç”±ç¨åŠ¡æœºå…³è®¤å®šï¼Œæœ¬å·¥å…·ä»…ä½œå‚è€ƒè®¡ç®—ã€‚</div>';
            }

            vatResultEl.innerHTML = html;
        }

        // åˆå§‹åŒ–: ensure default selected card on load
        (function(){
            // ensure one selected
            if (!document.querySelector('.tax-city-card.selected')) {
                var first = document.querySelector('.tax-city-card');
                if (first) first.classList.add('selected');
            }
        })();
    </script>
</body>
</html>
